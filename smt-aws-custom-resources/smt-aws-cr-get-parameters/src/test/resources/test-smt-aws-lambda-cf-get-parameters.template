{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "This template creates the smt-aws-lambda-cf-get-parameters lambda along with it's role and policy.",
  "Parameters": {
    "TestParameterName1": {
      "Type": "String",
      "Default": "smt-aws-lambda-cf-get-parameters-test-parameter1",
      "Description": "This should be set to the name of the first test parameter that will be created and read."
    },
    "TestParameterValue1": {
      "Type": "String",
      "Default": "This is the first test value.",
      "Description": "This should be set to the value of the first test parameter that will be created and read."
    },
    "TestParameterName2": {
      "Type": "String",
      "Default": "smt-aws-lambda-cf-get-parameters-test-parameter2",
      "Description": "This should be set to the name of the second test parameter that will be created and read."
    },
    "TestParameterValue2": {
      "Type": "String",
      "Default": "This is the second test value.",
      "Description": "This should be set to the value of the second test parameter that will be created and read."
    }
  },
  "Resources": {
    "TestParameter1": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": { "Ref": "TestParameterName1" },
        "Description": "This parameter was created to test the lambda-cf-get-parameters custom resource.",
        "Type": "String",
        "Value": { "Ref": "TestParameterValue1" }
      }
    },
    "TestParameter2": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": { "Ref": "TestParameterName2" },
        "Description": "This parameter was created to test the lambda-cf-get-parameters custom resource.",
        "Type": "String",
        "Value": { "Ref": "TestParameterValue2" }
      }
    },
    "TestGetParameter": {
      "Type": "Custom::GetParameter",
      "Version": "1.0",
      "DependsOn": ["TestParameter1", "TestParameter2"],
      "Properties": {
        "ServiceToken": "arn:aws:lambda:ap-southeast-2:259292411567:function:smt-aws-lambda-cf-get-parameters",
        "ParameterNames": [{ "Ref": "TestParameterName1" }, { "Ref": "TestParameterName2" }],
        "ForceUpdate": "Change the text in this property to force an update."
      }
    },
    "TestEchoParameter1": {
      "Type": "AWS::SSM::Parameter",
      "DependsOn": ["TestGetParameter"],
      "Properties": {
        "Name": { "Fn::Sub": "echo-${TestParameterName1}" },
        "Description": "The private IP of the SonarQube EC2 instance.",
        "Type": "String",
        "Value": {
          "Fn::Join": ["", ["ECHO: ", { "Fn::GetAtt": ["TestGetParameter", { "Ref": "TestParameterName1" }] }]]
        }
      }
    },
    "TestEchoParameter2": {
      "Type": "AWS::SSM::Parameter",
      "DependsOn": ["TestGetParameter"],
      "Properties": {
        "Name": { "Fn::Sub": "echo-${TestParameterName2}" },
        "Description": "The private IP of the SonarQube EC2 instance.",
        "Type": "String",
        "Value": {
          "Fn::Join": ["", ["ECHO: ", { "Fn::GetAtt": ["TestGetParameter", { "Ref": "TestParameterName2" }] }]]
        }
      }
    }
  }
}